# telegram-yandex-calendar-notifier

Telegram-–±–æ—Ç –Ω–∞ Go, –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ ICal (–Ø–Ω–¥–µ–∫—Å –ö–∞–ª–µ–Ω–¥–∞—Ä—å) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ICal-—Å—Å—ã–ª–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `users.json` (`telegram_user_id`, `username`, `ical_urls`).
- –ö–Ω–æ–ø–∫–∏ –≤ –±–æ—Ç–µ:
  - `üìÖ –°–æ–±—ã—Ç–∏—è —Å–µ–≥–æ–¥–Ω—è`
  - `üåÖ –°–æ–±—ã—Ç–∏—è –∑–∞–≤—Ç—Ä–∞`
  - `üóì –°–æ–±—ã—Ç–∏—è –Ω–µ–¥–µ–ª–∏`
  - `üîú –ë–ª–∏–∂–∞–π—à–µ–µ —Å–æ–±—ã—Ç–∏–µ`
  - `üîî/üîï –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ`
- –§–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π –ø–æ `POLL_EVERY`.
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:
  - –∑–∞ 15 –º–∏–Ω—É—Ç
  - –∑–∞ 5 –º–∏–Ω—É—Ç
  - –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–∏ –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –Ω–∞—á–∞–ª–æ—Å—å –Ω–µ –±–æ–ª–µ–µ 10 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ –≤—ã—Ö–æ–¥–Ω—ã–º –≤—ã–∫–ª—é—á–µ–Ω—ã; –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∏—Ç—å –∏—Ö –∫–Ω–æ–ø–∫–æ–π.
- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –≤ `DAILY_DIGEST_TIME` —Å–æ —Å–ø–∏—Å–∫–æ–º —Å–æ–±—ã—Ç–∏–π –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–æ–±—ã—Ç–∏–π (`RRULE`, `RDATE`, `EXDATE`).
- –õ–æ–≥–∏:
  - –≤—ã–≤–æ–¥ –≤ stdout
  - —Ñ–∞–π–ª `LOG_DIR/current.log`
  - –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –≤ `.gz`
  - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–æ–≤ `LOG_RETENTION_DAYS`.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ü—Ä–∏–º–µ—Ä –≤ `.env.example`:

- `TELEGRAM_BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `USERS_FILE` ‚Äî –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `data/users.json`)
- `POLL_EVERY` ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–ø—Ä–æ—Å–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è (–Ω–∞–ø—Ä–∏–º–µ—Ä `5m`, `1s`)
- `DAILY_DIGEST_TIME` ‚Äî –≤—Ä–µ–º—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ (`HH:MM`)
- `TZ_LOCATION` ‚Äî timezone (–Ω–∞–ø—Ä–∏–º–µ—Ä `Europe/Moscow`)
- `HTTP_TIMEOUT` ‚Äî timeout HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä `20s`)
- `HELP_IMAGE_PATH` ‚Äî –ø—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è `/start`
- `LOG_DIR` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ª–æ–≥–æ–≤
- `LOG_ROTATE_TIME` ‚Äî –≤—Ä–µ–º—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤ (`HH:MM`)
- `LOG_RETENTION_DAYS` ‚Äî —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Ö—Ä–∞–Ω–∏—Ç—å –∞—Ä—Ö–∏–≤—ã –ª–æ–≥–æ–≤

## –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ BotFather –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω.
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`.
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `TELEGRAM_BOT_TOKEN`.
4. –ó–∞–ø—É—Å–∫:

```bash
go run main.go
```

## Docker
–°–±–æ—Ä–∫–∞:

```bash
docker build -t yandex-calendar-bot .
```

–ó–∞–ø—É—Å–∫ (PowerShell):

```powershell
docker run -d --name yandex-calendar-bot --restart unless-stopped `
  --env-file .\.env `
  -e USERS_FILE=/app/data/users.json `
  -v "${PWD}\data:/app/data" `
  yandex-calendar-bot
```

## –§–æ—Ä–º–∞—Ç users.json
```json
[
  {
    "telegram_user_id": 123456789,
    "username": "telegram_username",
    "ical_urls": [
      "https://calendar.yandex.ru/export/ical/one.ics",
      "https://calendar.yandex.ru/export/ical/two.ics"
    ]
  }
]
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (`help.png`).
- –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ ICal-—Å—Å—ã–ª–∫—É —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
- –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ —Å–æ–±—ã—Ç–∏–π.
